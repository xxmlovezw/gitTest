<!DOCTYPE html>
<html>
<head>
	<title>借阅记录</title>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<link rel="stylesheet" type="text/css" href="../font-awesome/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="../style/readerMain.css">
	<link rel="stylesheet" type="text/css" href="../style/readerBorrowed.css">
	<script type="text/javascript" src="../script/jquery-2.1.4.min.js"></script>
    <script src="https://cdn.staticfile.org/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
	<script type="text/javascript">
	  $(function(){
	  	 var Lis=$(".menu ul li").eq(4);
	  	 Lis.css('border-bottom', '7px solid #419EDC');
	  	 Lis.css('margin-top', '-7px');
	  	 Lis.css('color', '#419EDC');
	  	 $(".table tbody tr:odd").css("backgroundColor","#F2F2D6");

          var json = $.cookie('login');
          console.log(json);
          var  obj = JSON.parse(json);
          var userName = obj.userName;
          var userId = obj.userId;
          $(".reader_name").text(userName);

          $(".out_page").click(function () {
              $.cookie("login",null);
              $(location).attr('href',"../html/index.html");
          });

          fetch("/borrowRecords/borrowed?userId="+userId,{
              method:"get",
              headers:{
                  'content-type':'application/x-www-form-urlencoded; charset=UTF-8'
              }
          }).then(function (response) {
              response.json().then(function (value) {
                  console.log(value)
                  var eval1 = eval(value);
                  for (var i in eval1){
                  	  var borrowTime = eval1[i].borrowTime.substr(0,eval1[i].borrowTime.indexOf("T"));
                  	  var returnTime;
                  	  if (eval1[i].returnTime != null){
                  	  	returnTime = eval1[i].returnTime.substr(0,eval1[i].returnTime.indexOf("T"));
 					  } else {
                  	  	returnTime = "未归还"
					  }
                      addTable(parseInt(i)+1,eval1[i].borrowId,eval1[i].bookName,borrowTime,returnTime)
                  }
              })
          }).catch(function (reason) {

          })
	  })

      function addTable(Id,borrowId,bookName,borrowTime,returnTime) {
          console.log("添加tr");
          var table = $(".table tbody");
          table.append('<tr class="data_borrow">' +
              '<td>'+Id+'</td>' +
              '<td>'+borrowId+'</td>' +
              '<td>'+bookName+'</td>' +
              '<td>'+borrowTime+'</td>' +
              '<td>'+returnTime+'</td>' +
              '</tr>');
      }
	</script>
</head>
<body>
<div class="header">
	<div class="header">
		<div class="home_logo"><a  href="../html/index.html"><i class="fa fa-home">首页</i></a></div>
		<div class="page_title">个人中心</div>
		<div class="out_page">退出</div>
	</div>
</div>
<div class="book_logo">
	<img src="../images/booklogo.png">
</div>
<div class="reader_name">张三</div>
<div class="menu">
	<ul>
		<a href="../html/readerPersonal.html"><li class="first_li">基本资料</li></a>
		<a href="../html/readerAlterData.html"><li class="other_li">修改资料</li></a>
		<a href="../html/readerAlterPaswd.html"><li class="other_li">修改密码</li></a>
		<a href="../html/readerBorrowing.html"><li class="other_li">在借图书</li></a>
		<a href="../html/readerBorrowed.html"><li class="last_li">借阅记录</li></a>
	</ul>
	<div class="clear"></div>
</div>
<!-- class="content"的div中是个人中心的切换部分 -->
<div class="content">
	<div class="table_div">
          <table class="table">
            <thead>
              <th>序号</th>
              <th>借阅号</th>
              <th>图书名</th>
              <th>借书日期</th>
              <th>还书日期</th>
            </thead>
            <tbody>

            </tbody>
           </table>
        </div>
</div>
<div class="footer">
	    <br/>   
		<p>@Copyright重庆理工大学中山图书馆</p>
	</div>
</body>
</html>